{
  "topic_title": "Cloud Metadata Service 005_Exploitation",
  "category": "008_Application Security - Web 008_Application Security",
  "flashcards": [
    {
      "question_text": "What is the primary function of the Cloud Instance Metadata Service (IMDS)?",
      "correct_answer": "To provide information about the EC2 instance and its associated IAM role credentials.",
      "distractors": [
        {
          "text": "To manage network traffic routing for cloud instances.",
          "misconception": "Targets [domain confusion]: Confuses IMDS with network routing services like VPC route tables."
        },
        {
          "text": "To store application configuration data for deployment.",
          "misconception": "Targets [purpose confusion]: Mixes IMDS with configuration management or secret storage solutions."
        },
        {
          "text": "To enforce security group rules and firewall policies.",
          "misconception": "Targets [responsibility confusion]: Attributes IMDS with network security enforcement, which is handled by security groups."
        }
      ],
      "detailed_explanation": {
        "core_logic": "The IMDS provides essential runtime information about EC2 instances, including IAM credentials, because it's designed to be accessed from within the instance itself. It functions by exposing a local HTTP endpoint (e.g., 169.254.169.254) that applications can query, connecting instance identity to cloud provider services.",
        "distractor_analysis": "The distractors confuse IMDS with network routing, configuration management, and security group enforcement, failing to recognize its specific role in providing instance-specific metadata and credentials.",
        "analogy": "Think of the IMDS as the instance's internal ID card and access badge, providing details about who it is and what it's allowed to do within the cloud environment."
      },
      "code_snippets": [],
      "difficulty": "foundational",
      "question_type": "definition",
      "bloom_level": "understand",
      "prerequisites": [
        "IMDS_BASICS"
      ]
    },
    {
      "question_text": "Which vulnerability type is most commonly exploited to access the Cloud Instance Metadata Service (IMDS) from an external application?",
      "correct_answer": "Server-Side Request Forgery (SSRF)",
      "distractors": [
        {
          "text": "Cross-Site Scripting (XSS)",
          "misconception": "Targets [injection type confusion]: Mixes client-side script injection with server-side request manipulation."
        },
        {
          "text": "SQL Injection (SQLi)",
          "misconception": "Targets [injection target confusion]: Associates database query manipulation with network request interception."
        },
        {
          "text": "XML External Entity (XXE) Injection",
          "misconception": "Targets [related vulnerability confusion]: While XXE can sometimes lead to SSRF, SSRF is the direct vulnerability exploited to reach IMDS."
        }
      ],
      "detailed_explanation": {
        "core_logic": "SSRF allows an attacker to coerce a server-side application into making unintended HTTP requests to arbitrary destinations, including the IMDS endpoint. This works by exploiting flaws in how the application handles user-supplied URLs, enabling access to internal services like IMDS that are not meant to be exposed externally.",
        "distractor_analysis": "XSS and SQLi are distinct injection flaws targeting different layers (client-side scripts and databases, respectively). XXE is related but SSRF is the direct vulnerability type that enables accessing the IMDS endpoint.",
        "analogy": "SSRF is like tricking a receptionist into making a phone call for you to a restricted internal extension, allowing you to get information they shouldn't share."
      },
      "code_snippets": [],
      "difficulty": "intermediate",
      "question_type": "attack",
      "bloom_level": "apply",
      "prerequisites": [
        "SSRF_BASICS",
        "IMDS_BASICS"
      ]
    },
    {
      "question_text": "What is the significance of IMDSv2 compared to IMDSv1 in AWS?",
      "correct_answer": "IMDSv2 requires a session-oriented token, making SSRF and XXE attacks more difficult to exploit for credential theft.",
      "distractors": [
        {
          "text": "IMDSv2 encrypts all metadata requests, ensuring data confidentiality.",
          "misconception": "Targets [encryption confusion]: Assumes IMDSv2 adds transport layer encryption, which is not its primary security enhancement."
        },
        {
          "text": "IMDSv2 automatically revokes credentials after each use.",
          "misconception": "Targets [revocation confusion]: Misunderstands the session token mechanism as automatic credential expiration per request."
        },
        {
          "text": "IMDSv2 is only accessible from outside the EC2 instance.",
          "misconception": "Targets [access control confusion]: Reverses the access control, believing IMDSv2 restricts access from within the instance."
        }
      ],
      "detailed_explanation": {
        "core_logic": "IMDSv2 enhances security by requiring a session token for all metadata requests, which must be obtained via a PUT request. This works by establishing a session that prevents simple, unauthenticated GET requests often used in SSRF/XXE attacks to steal credentials, thus significantly mitigating these risks.",
        "distractor_analysis": "The distractors incorrectly claim IMDSv2 adds encryption, automates credential revocation per request, or restricts access from within the instance, missing the core security improvement of session-token authentication.",
        "analogy": "IMDSv1 is like an unlocked door to a room with sensitive documents. IMDSv2 is like that same door requiring a unique, time-limited keycard for each entry, making it harder for unauthorized people to just walk in."
      },
      "code_snippets": [],
      "difficulty": "intermediate",
      "question_type": "comparison",
      "bloom_level": "analyze",
      "prerequisites": [
        "IMDSV1_IMDSV2",
        "SSRF_MITIGATION"
      ]
    },
    {
      "question_text": "Why is it critical to enforce IMDSv2 for all EC2 instances?",
      "correct_answer": "To significantly reduce the risk of adversaries stealing IAM credentials via SSRF or XXE attacks.",
      "distractors": [
        {
          "text": "To improve the performance of instance metadata retrieval.",
          "misconception": "Targets [performance vs. security confusion]: Focuses on a non-existent performance benefit instead of the security enhancement."
        },
        {
          "text": "To enable direct access to sensitive user data stored on the instance.",
          "misconception": "Targets [data access confusion]: Misunderstands IMDS's purpose as a data storage or retrieval mechanism for user files."
        },
        {
          "text": "To automatically patch operating system vulnerabilities on the instance.",
          "misconception": "Targets [patching vs. security confusion]: Confuses metadata service security with OS-level vulnerability management."
        }
      ],
      "detailed_explanation": {
        "core_logic": "Enforcing IMDSv2 is critical because it adds a mandatory session token requirement, directly countering the common SSRF/XXE attack vectors used to exfiltrate IAM credentials. This works by making it much harder for an attacker to trick an application into making unauthorized requests to the metadata endpoint, thereby protecting sensitive credentials.",
        "distractor_analysis": "The distractors incorrectly attribute performance improvements, direct user data access, or OS patching capabilities to IMDSv2, failing to grasp its primary function as a security control against credential theft.",
        "analogy": "Enforcing IMDSv2 is like upgrading from a simple lock to a multi-factor authentication system for your building's access control; it adds a crucial layer of security against unauthorized entry."
      },
      "code_snippets": [],
      "difficulty": "advanced",
      "question_type": "defense",
      "bloom_level": "apply",
      "prerequisites": [
        "IMDSV2_ENFORCEMENT",
        "SSRF_MITIGATION"
      ]
    },
    {
      "question_text": "What information can an attacker potentially retrieve by successfully exploiting an SSRF vulnerability against the EC2 Instance Metadata Service?",
      "correct_answer": "Temporary IAM credentials (access key ID, secret access key, session token) associated with the instance's IAM role.",
      "distractors": [
        {
          "text": "The root user credentials for the AWS account.",
          "misconception": "Targets [credential scope confusion]: Assumes IMDS provides root credentials, which are never exposed via instance metadata."
        },
        {
          "text": "The private SSH keys for all users on the instance.",
          "misconception": "Targets [key management confusion]: Confuses instance metadata with system-level user credential storage."
        },
        {
          "text": "The source code of applications running on the instance.",
          "misconception": "Targets [data type confusion]: Mistakenly believes IMDS exposes application source code instead of runtime/identity information."
        }
      ],
      "detailed_explanation": {
        "core_logic": "By exploiting SSRF to query the IMDS endpoint (e.g., <code>169.254.169.254</code>), an attacker can retrieve temporary IAM credentials. These credentials, consisting of an access key ID, secret access key, and session token, are associated with the IAM role assigned to the EC2 instance, granting the attacker permissions defined by that role.",
        "distractor_analysis": "The distractors incorrectly suggest retrieval of root credentials, user SSH keys, or application source code, failing to recognize that IMDS primarily exposes instance identity and temporary IAM role credentials.",
        "analogy": "Successfully exploiting IMDS via SSRF is like finding a lost employee ID badge that grants you access to specific company resources based on the employee's role, but not the company's master keys."
      },
      "code_snippets": [],
      "difficulty": "advanced",
      "question_type": "attack",
      "bloom_level": "apply",
      "prerequisites": [
        "IMDS_CREDENTIAL_THEFT",
        "SSRF_EXPLOITATION"
      ]
    },
    {
      "question_text": "Which of the following is a common indicator that an EC2 instance has an IAM role attached, when querying the IMDS?",
      "correct_answer": "A successful response from the <code>/latest/meta-data/iam/security-credentials/</code> endpoint.",
      "distractors": [
        {
          "text": "A 404 error when querying the <code>/latest/meta-data/hostname</code> endpoint.",
          "misconception": "Targets [endpoint confusion]: Associates IAM role presence with a different metadata endpoint (hostname)."
        },
        {
          "text": "A successful response from the <code>/latest/meta-data/public-keys/</code> endpoint.",
          "misconception": "Targets [metadata category confusion]: Links IAM roles to public key metadata, which is distinct."
        },
        {
          "text": "An empty response from the <code>/latest/meta-data/instance-id</code> endpoint.",
          "misconception": "Targets [instance identifier confusion]: Relates IAM role presence to the instance ID endpoint, which should always return a value."
        }
      ],
      "detailed_explanation": {
        "core_logic": "The presence of an IAM role is typically indicated by a successful response (often a 200 OK with the role name) when querying the specific IMDS path for IAM security credentials. This works because the metadata service organizes role information under this predictable path, allowing an application or attacker to discover and access it.",
        "distractor_analysis": "The distractors suggest incorrect endpoints or response types (404, public keys, instance ID) as indicators for IAM roles, confusing them with other metadata categories or misinterpreting error/empty responses.",
        "analogy": "It's like checking the 'Department' field on an employee directory to see if they belong to a specific team; the '/iam/security-credentials/' path is the specific field for checking IAM role assignment."
      },
      "code_snippets": [],
      "difficulty": "intermediate",
      "question_type": "analysis",
      "bloom_level": "analyze",
      "prerequisites": [
        "IMDS_METADATA_PATHS",
        "IAM_ROLES"
      ]
    },
    {
      "question_text": "What is the purpose of the <code>X-aws-ec2-metadata-token-ttl-seconds</code> header when using IMDSv2?",
      "correct_answer": "To specify the desired time-to-live (TTL) for the metadata session token.",
      "distractors": [
        {
          "text": "To authenticate the user making the metadata request.",
          "misconception": "Targets [authentication confusion]: Mistakenly believes the TTL header is for user authentication, not token duration."
        },
        {
          "text": "To encrypt the metadata response.",
          "misconception": "Targets [encryption confusion]: Assumes the TTL header is related to data encryption rather than token validity."
        },
        {
          "text": "To specify the instance's time zone.",
          "misconception": "Targets [metadata type confusion]: Confuses a request header parameter with instance configuration metadata."
        }
      ],
      "detailed_explanation": {
        "core_logic": "The <code>X-aws-ec2-metadata-token-ttl-seconds</code> header is used in the initial PUT request to obtain a session token for IMDSv2. It allows the client to specify how long the token should be valid (e.g., 21600 seconds for 6 hours). This works by informing the IMDS service about the desired duration for the session it creates.",
        "distractor_analysis": "The distractors incorrectly identify the TTL header's purpose as user authentication, response encryption, or setting the instance's time zone, failing to recognize its role in defining the session token's lifespan.",
        "analogy": "It's like setting an expiration date on a temporary pass; the TTL header tells the system how long the pass (token) should remain valid."
      },
      "code_snippets": [],
      "difficulty": "intermediate",
      "question_type": "definition",
      "bloom_level": "understand",
      "prerequisites": [
        "IMDSV2_TOKEN_ ACQUISITION"
      ]
    },
    {
      "question_text": "How can an attacker leverage ICMP (Internet Control Message Protocol) in advanced cloud metadata service abuse scenarios?",
      "correct_answer": "By crafting ICMP packets to probe for and potentially exfiltrate metadata, evading traditional HTTP-based detection.",
      "distractors": [
        {
          "text": "By using ICMP to establish encrypted tunnels to the metadata service.",
          "misconception": "Targets [protocol confusion]: Assumes ICMP inherently supports encryption for tunneling, which is not its function."
        },
        {
          "text": "By sending ICMP requests to directly modify IAM policies.",
          "misconception": "Targets [action confusion]: Believes ICMP can directly alter cloud resource configurations like IAM policies."
        },
        {
          "text": "By using ICMP to brute-force default instance credentials.",
          "misconception": "Targets [attack vector confusion]: Mixes network probing (ICMP) with credential brute-forcing, which uses different protocols."
        }
      ],
      "detailed_explanation": {
        "core_logic": "Advanced attackers can use ICMP to interact with cloud metadata services by embedding data within ICMP packets or using ICMP responses to infer network structures, potentially reaching metadata endpoints that aren't strictly HTTP-based or are protected by simpler firewalls. This works by exploiting less scrutinized network protocols for reconnaissance and data exfiltration, evading common HTTP-based SSRF detection.",
        "distractor_analysis": "The distractors incorrectly suggest ICMP can establish encryption, directly modify IAM policies, or perform brute-force attacks on credentials, misunderstanding its role as a network layer protocol for control and error messages.",
        "analogy": "Using ICMP for metadata abuse is like sending coded messages in seemingly harmless network 'pings' to gather intelligence, bypassing standard security checkpoints that only watch for web traffic."
      },
      "code_snippets": [],
      "difficulty": "expert",
      "question_type": "attack",
      "bloom_level": "analyze",
      "prerequisites": [
        "ICMP_BASICS",
        "ADVANCED_SSRF"
      ]
    },
    {
      "question_text": "What is a key risk associated with exposing EC2 instance metadata, even with IMDSv2 enabled?",
      "correct_answer": "Applications that process metadata unsafely (e.g., via vulnerable HTTP proxies) can still leak credentials.",
      "distractors": [
        {
          "text": "IMDSv2 completely eliminates the risk of credential exposure.",
          "misconception": "Targets [overconfidence in defense]: Assumes IMDSv2 provides absolute protection, ignoring application-level vulnerabilities."
        },
        {
          "text": "The metadata service itself can be directly compromised by external attackers.",
          "misconception": "Targets [attack surface confusion]: Believes the IMDS service endpoint itself is directly hackable from the internet."
        },
        {
          "text": "Instance metadata is automatically logged by cloud providers, creating audit risks.",
          "misconception": "Targets [logging confusion]: Confuses metadata access with audit log generation, which is a separate security concern."
        }
      ],
      "detailed_explanation": {
        "core_logic": "Even with IMDSv2, applications running on an EC2 instance that interact with the metadata service through vulnerable intermediaries (like poorly configured HTTP proxies or XML parsers) can inadvertently leak the session token or credentials. This works because the vulnerability lies in the application's handling of requests, not solely in the IMDS endpoint's security.",
        "distractor_analysis": "The distractors incorrectly claim IMDSv2 offers complete protection, that the IMDS service itself is directly hackable externally, or that metadata access inherently creates audit risks via provider logging, missing the nuance of application-level risks.",
        "analogy": "Even with a secure vault (IMDSv2), if the employee carrying the keycard (application) uses a faulty elevator (proxy) that exposes the card's data, the information can still be compromised."
      },
      "code_snippets": [],
      "difficulty": "advanced",
      "question_type": "analysis",
      "bloom_level": "evaluate",
      "prerequisites": [
        "IMDSV2_LIMITATIONS",
        "APPLICATION_SECURITY_RISKS"
      ]
    },
    {
      "question_text": "Which NIST Special Publication provides guidance relevant to securing cloud environments and mitigating risks like IMDS exploitation?",
      "correct_answer": "NIST SP 800-145 (The NIST Definition of Cloud Computing)",
      "distractors": [
        {
          "text": "NIST SP 800-53 (Security and Privacy Controls for Information Systems and Organizations)",
          "misconception": "Targets [standard scope confusion]: While relevant for controls, SP 800-53 doesn't specifically define cloud computing concepts like IMDS."
        },
        {
          "text": "NIST SP 1800-26 (Securing IoT Devices)",
          "misconception": "Targets [domain mismatch]: Focuses on IoT security, not general cloud infrastructure and metadata services."
        },
        {
          "text": "NIST SP 800-63 (Digital Identity Guidelines)",
          "misconception": "Targets [specific control confusion]: Focuses on digital identity management, not the specific cloud service metadata context."
        }
      ],
      "detailed_explanation": {
        "core_logic": "NIST SP 800-145 defines cloud computing, its essential characteristics, service models, and deployment models, providing a foundational understanding necessary to address cloud-specific security concerns like IMDS. Understanding these definitions helps contextualize risks and defenses related to cloud services.",
        "distractor_analysis": "The distractors cite other relevant NIST publications but misapply them to the specific context of defining cloud computing and its inherent services like IMDS. SP 800-53 offers controls, SP 1800-26 is IoT-focused, and SP 800-63 is about digital identity.",
        "analogy": "NIST SP 800-145 is like the dictionary defining 'cloud' and its components; other NIST documents are like guides on how to secure specific parts of that 'cloud' environment."
      },
      "code_snippets": [],
      "difficulty": "intermediate",
      "question_type": "definition",
      "bloom_level": "understand",
      "prerequisites": [
        "NIST_CLOUD_SECURITY",
        "IMDS_CONTEXT"
      ]
    },
    {
      "question_text": "What is the primary security benefit of using Instance Metadata Service Version 2 (IMDSv2) over Version 1 (IMDSv1)?",
      "correct_answer": "IMDSv2 requires a session-oriented token, mitigating SSRF and XXE attacks that target IMDSv1.",
      "distractors": [
        {
          "text": "IMDSv2 provides end-to-end encryption for all metadata.",
          "misconception": "Targets [encryption confusion]: Incorrectly assumes IMDSv2 adds transport layer encryption, which is not its primary function."
        },
        {
          "text": "IMDSv2 automatically rotates IAM credentials more frequently.",
          "misconception": "Targets [credential rotation confusion]: Confuses the mechanism for accessing credentials with the rotation policy itself."
        },
        {
          "text": "IMDSv2 limits the types of information accessible via metadata.",
          "misconception": "Targets [scope reduction confusion]: Assumes IMDSv2 restricts the *amount* or *type* of data, rather than the *access method*."
        }
      ],
      "detailed_explanation": {
        "core_logic": "IMDSv2's core security improvement is the mandatory session token, obtained via a PUT request. This works by requiring an authenticated, session-based interaction, making it significantly harder for attackers to exploit SSRF or XXE vulnerabilities to simply make GET requests and steal credentials, unlike the less secure IMDSv1.",
        "distractor_analysis": "The distractors incorrectly attribute end-to-end encryption, enhanced credential rotation, or scope reduction as the primary benefits of IMDSv2, missing its key role in mitigating SSRF/XXE via session tokens.",
        "analogy": "IMDSv1 is like leaving your house key under the doormat; IMDSv2 is like requiring a unique, time-limited keycard that you must specifically request each time you enter."
      },
      "code_snippets": [],
      "difficulty": "intermediate",
      "question_type": "comparison",
      "bloom_level": "analyze",
      "prerequisites": [
        "IMDSV1_IMDSV2",
        "SSRF_MITIGATION"
      ]
    },
    {
      "question_text": "Consider an application running on an EC2 instance that is vulnerable to SSRF. If this application makes an outbound HTTP request to <code>http://169.254.169.254/latest/meta-data/iam/security-credentials/ROLE_NAME</code>, what is the attacker attempting to achieve?",
      "correct_answer": "Steal the temporary IAM credentials (access key ID, secret access key, session token) associated with the specified IAM role.",
      "distractors": [
        {
          "text": "Download the instance's operating system image.",
          "misconception": "Targets [data type confusion]: Assumes IMDS provides access to OS images, which are not part of instance metadata."
        },
        {
          "text": "Modify the instance's firewall rules.",
          "misconception": "Targets [control plane confusion]: Believes IMDS can be used to alter network security configurations."
        },
        {
          "text": "Execute arbitrary commands on the EC2 instance.",
          "misconception": "Targets [vulnerability type confusion]: Confuses SSRF against IMDS with remote code execution vulnerabilities."
        }
      ],
      "detailed_explanation": {
        "core_logic": "By directing the SSRF-vulnerable application to query the specific IMDS path for IAM security credentials, an attacker aims to retrieve the temporary credentials associated with the specified role. This works because the IMDS endpoint is designed to serve this information to authorized entities within the instance, and SSRF bypasses normal access controls.",
        "distractor_analysis": "The distractors incorrectly suggest the attacker is trying to download OS images, modify firewall rules, or execute commands, failing to recognize that the targeted URL specifically requests IAM role credentials from the metadata service.",
        "analogy": "The attacker is using the vulnerable application as a messenger to ask the 'information desk' (IMDS) for the 'access pass' (IAM credentials) of a specific employee (role)."
      },
      "code_snippets": [],
      "difficulty": "intermediate",
      "question_type": "scenario",
      "bloom_level": "apply",
      "prerequisites": [
        "SSRF_IMDS_INTERACTION",
        "IAM_CREDENTIALS"
      ]
    },
    {
      "question_text": "What is the potential impact if an attacker successfully steals temporary IAM credentials from an EC2 instance's metadata?",
      "correct_answer": "The attacker can perform actions within the AWS environment using the permissions granted by the compromised IAM role.",
      "distractors": [
        {
          "text": "The attacker gains administrative access to the attacker's own AWS account.",
          "misconception": "Targets [scope confusion]: Assumes stolen credentials affect the attacker's account, not the victim's."
        },
        {
          "text": "The attacker can only access data stored within the compromised EC2 instance.",
          "misconception": "Targets [resource scope confusion]: Limits the impact to the instance itself, ignoring broader AWS service access."
        },
        {
          "text": "The attacker can disable the EC2 instance's network connectivity.",
          "misconception": "Targets [specific action confusion]: Focuses on a single, limited action rather than the broad permissions granted by the role."
        }
      ],
      "detailed_explanation": {
        "core_logic": "Stolen temporary IAM credentials grant the attacker the same permissions as the compromised IAM role. This works because AWS uses these credentials to authenticate API requests, allowing the attacker to interact with various AWS services (like S3, EC2, RDS) according to the role's defined policies, potentially leading to data exfiltration, resource manipulation, or further compromise.",
        "distractor_analysis": "The distractors incorrectly limit the impact to the attacker's own account, only the compromised instance, or a single network action, failing to recognize that stolen IAM credentials provide broad access based on the role's permissions across AWS services.",
        "analogy": "Stealing IAM credentials is like stealing an employee's ID badge; the attacker can then use that badge to access company resources and perform tasks the employee was authorized to do."
      },
      "code_snippets": [],
      "difficulty": "advanced",
      "question_type": "analysis",
      "bloom_level": "analyze",
      "prerequisites": [
        "IAM_ROLE_PERMISSIONS",
        "IMDS_CREDENTIAL_THEFT_IMPACT"
      ]
    },
    {
      "question_text": "Which of the following is a recommended best practice to prevent unauthorized access to EC2 instance metadata?",
      "correct_answer": "Enforce the use of IMDSv2 for all EC2 instances.",
      "distractors": [
        {
          "text": "Disable all outbound network traffic from EC2 instances.",
          "misconception": "Targets [overly restrictive defense]: Proposes a solution that cripples instance functionality and is impractical."
        },
        {
          "text": "Manually revoke IAM role credentials after each API call.",
          "misconception": "Targets [manual process confusion]: Suggests an unfeasible manual process instead of leveraging automated security features."
        },
        {
          "text": "Store sensitive application secrets directly in instance metadata.",
          "misconception": "Targets [misuse of metadata]: Recommends using IMDS for secret storage, which is insecure and not its intended purpose."
        }
      ],
      "detailed_explanation": {
        "core_logic": "Enforcing IMDSv2 is a direct defense against common SSRF/XXE attacks targeting the metadata service. It works by requiring a session token, which prevents simple, unauthenticated requests that attackers exploit in IMDSv1, thereby significantly reducing the risk of credential theft.",
        "distractor_analysis": "The distractors suggest impractical network restrictions, unfeasible manual credential management, or insecure use of metadata for secret storage, failing to identify the most effective and recommended defense mechanism.",
        "analogy": "The best practice is like ensuring all doors require a unique, time-limited keycard (IMDSv2) instead of just a simple lock (IMDSv1), making unauthorized entry much harder."
      },
      "code_snippets": [],
      "difficulty": "intermediate",
      "question_type": "defense",
      "bloom_level": "apply",
      "prerequisites": [
        "IMDSV2_ENFORCEMENT",
        "SSRF_MITIGATION"
      ]
    },
    {
      "question_text": "What is the purpose of the <code>iam/security-credentials/</code> path within the EC2 Instance Metadata Service?",
      "correct_answer": "To retrieve the temporary security credentials associated with an IAM role assigned to the instance.",
      "distractors": [
        {
          "text": "To list all available IAM roles within the AWS account.",
          "misconception": "Targets [scope confusion]: Assumes IMDS can enumerate all roles in an account, rather than just the instance's assigned role."
        },
        {
          "text": "To update the instance's IAM role trust policy.",
          "misconception": "Targets [configuration management confusion]: Believes IMDS can be used to modify IAM policies, which requires separate IAM actions."
        },
        {
          "text": "To retrieve the instance's public SSH key.",
          "misconception": "Targets [metadata category confusion]: Confuses IAM credential paths with paths related to instance keys or configuration."
        }
      ],
      "detailed_explanation": {
        "core_logic": "The <code>iam/security-credentials/</code> path is specifically designed to provide access to the temporary credentials (access key ID, secret access key, session token) for the IAM role attached to the EC2 instance. This works by organizing metadata hierarchically, allowing applications or attackers to navigate to the specific information they need regarding the instance's identity and permissions.",
        "distractor_analysis": "The distractors incorrectly suggest this path is for listing all IAM roles, updating trust policies, or retrieving SSH keys, failing to recognize its specific function related to the instance's assigned IAM role credentials.",
        "analogy": "This path is like the 'Credentials' section on an employee's internal profile, providing their specific access tokens for company systems, not a directory of all employees or a way to change their job title."
      },
      "code_snippets": [],
      "difficulty": "intermediate",
      "question_type": "definition",
      "bloom_level": "understand",
      "prerequisites": [
        "IMDS_METADATA_PATHS",
        "IAM_ROLES"
      ]
    },
    {
      "question_text": "How does the use of a vulnerable HTTP proxy by an application on an EC2 instance increase the risk of IMDS credential theft, even when IMDSv2 is enforced?",
      "correct_answer": "The proxy might forward requests containing the IMDSv2 session token to unintended destinations, effectively leaking it.",
      "distractors": [
        {
          "text": "The proxy might automatically upgrade the connection to IMDSv1.",
          "misconception": "Targets [protocol downgrade confusion]: Assumes the proxy can force a downgrade from IMDSv2 to IMDSv1."
        },
        {
          "text": "The proxy might cache and expose the IMDSv2 session token indefinitely.",
          "misconception": "Targets [caching confusion]: Believes proxies cache security tokens, which is generally not how they function for dynamic tokens."
        },
        {
          "text": "The proxy might inject malicious code into the metadata response.",
          "misconception": "Targets [injection confusion]: Confuses proxy functionality with code injection capabilities."
        }
      ],
      "detailed_explanation": {
        "core_logic": "A vulnerable HTTP proxy acting as an intermediary for an application's requests to IMDSv2 can inadvertently forward the crucial session token. If the proxy is misconfigured or has flaws, it might send this token in responses or to other destinations, allowing an attacker monitoring or compromising the proxy to capture the token and impersonate the instance.",
        "distractor_analysis": "The distractors incorrectly suggest the proxy forces protocol downgrades, caches tokens indefinitely, or injects malicious code, failing to identify the core risk: the proxy forwarding sensitive session token information to unintended locations.",
        "analogy": "It's like using a faulty mail forwarding service; while you intend to send a letter (metadata request) to a specific address, the service might accidentally copy the contents or send it to the wrong place, exposing your sensitive information (token)."
      },
      "code_snippets": [],
      "difficulty": "expert",
      "question_type": "analysis",
      "bloom_level": "evaluate",
      "prerequisites": [
        "IMDSV2_TOKEN_LEAKAGE",
        "PROXY_VULNERABILITIES"
      ]
    }
  ],
  "generation_metadata": {
    "model": "google/gemini-2.5-flash-lite",
    "num_generated": 16,
    "temperature": 0.1,
    "web_citations": [],
    "research_method": "openrouter_web_plugin",
    "search_query": "Cloud Metadata Service 005_Exploitation 008_Application Security best practices",
    "latency_ms": 30264.218
  },
  "timestamp": "2026-01-18T12:10:51.598208",
  "_av_safe_encoded": true,
  "_encoding_note": "Educational content encoded with HTML entities to prevent antivirus false positives. Content renders normally in Anki."
}